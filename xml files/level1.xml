<?xml version="1.0" encoding="UTF-8"?>
<mxGraphModel dx="1338" dy="761" grid="1" gridSize="10" guides="1" tooltips="1"
              connect="1" arrows="1" folding="1" page="1" pageScale="1" pageWidth="1920"
              pageHeight="3000" math="0" shadow="0">
  <root>
    <mxCell id="0"/>
    <mxCell id="1" parent="0"/>

    <!-- Title -->
    <mxCell id="t1" value="Level-1 DFD — Happenin (Vertical Flow)"
            style="text;html=1;strokeColor=none;fillColor=none;fontSize=18;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="500" y="20" width="800" height="28" as="geometry"/>
    </mxCell>

    <!-- ===== External Entities ===== -->
    <mxCell id="e_user" value="User"
            style="shape=rectangle;whiteSpace=wrap;html=1;rounded=0;fillColor=#DFF0D8;strokeColor=#6FB26F;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="100" y="140" width="160" height="70" as="geometry"/>
    </mxCell>

    <mxCell id="e_payment" value="Payment Gateway"
            style="shape=rectangle;whiteSpace=wrap;html=1;rounded=0;fillColor=#E9D9F1;strokeColor=#9B6FB2;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="100" y="940" width="200" height="70" as="geometry"/>
    </mxCell>

    <!-- ===== Processes (Middle, vertical stack) ===== -->
    <mxCell id="p1" value="P1 — Browse / Search Events"
            style="ellipse;whiteSpace=wrap;html=1;fillColor=#E7F1FF;strokeColor=#6C8EBF;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="500" y="120" width="280" height="90" as="geometry"/>
    </mxCell>

    <mxCell id="p2" value="P2 — Select Show &amp; Seats"
            style="ellipse;whiteSpace=wrap;html=1;fillColor=#E7F1FF;strokeColor=#6C8EBF;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="500" y="340" width="280" height="90" as="geometry"/>
    </mxCell>

    <mxCell id="p3" value="P3 — Checkout &amp; Payment"
            style="ellipse;whiteSpace=wrap;html=1;fillColor=#E7F1FF;strokeColor=#6C8EBF;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="500" y="560" width="300" height="90" as="geometry"/>
    </mxCell>

    <mxCell id="p4" value="P4 — Confirm Booking"
            style="ellipse;whiteSpace=wrap;html=1;fillColor=#E7F1FF;strokeColor=#6C8EBF;fontSize=13;fontStyle=1;"
            vertex="1" parent="1">
      <mxGeometry x="500" y="780" width="280" height="90" as="geometry"/>
    </mxCell>

    <!-- ===== Data Stores (Right, aligned vertically) ===== -->
    <mxCell id="ds_events" value="Events_DB"
            style="shape=datastore;whiteSpace=wrap;html=1;fillColor=#FFF7D9;strokeColor=#D6B656;fontSize=12;"
            vertex="1" parent="1">
      <mxGeometry x="1000" y="120" width="180" height="60" as="geometry"/>
    </mxCell>

    <mxCell id="ds_seats" value="Show_Seats_DB"
            style="shape=datastore;whiteSpace=wrap;html=1;fillColor=#FFF7D9;strokeColor=#D6B656;fontSize=12;"
            vertex="1" parent="1">
      <mxGeometry x="1000" y="340" width="180" height="60" as="geometry"/>
    </mxCell>

    <mxCell id="ds_payments" value="Payments_DB"
            style="shape=datastore;whiteSpace=wrap;html=1;fillColor=#FFF7D9;strokeColor=#D6B656;fontSize=12;"
            vertex="1" parent="1">
      <mxGeometry x="1000" y="560" width="180" height="60" as="geometry"/>
    </mxCell>

    <mxCell id="ds_bookings" value="Bookings_DB"
            style="shape=datastore;whiteSpace=wrap;html=1;fillColor=#FFF7D9;strokeColor=#D6B656;fontSize=12;"
            vertex="1" parent="1">
      <mxGeometry x="1000" y="780" width="180" height="60" as="geometry"/>
    </mxCell>

    <!-- ===== Flows ===== -->
    <!-- User ↔ P1 -->
    <mxCell id="f1" value="Search / filters"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="e_user" target="p1"/>
    <mxCell id="f2" value="Event list"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p1" target="e_user"/>

    <!-- P1 ↔ Events_DB -->
    <mxCell id="f3" value="Query events"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p1" target="ds_events"/>
    <mxCell id="f4" value="Event list / showtimes"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="ds_events" target="p1"/>

    <!-- User → P2 -->
    <mxCell id="f5" value="Select show &amp; seats"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="e_user" target="p2"/>

    <!-- P2 ↔ Seats_DB -->
    <mxCell id="f6" value="Seat availability / reserve\n(hold=5 min)"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p2" target="ds_seats"/>
    <mxCell id="f7" value="Seat status"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="ds_seats" target="p2"/>

    <!-- P2 → Bookings_DB -->
    <mxCell id="f8" value="Provisional booking\n(status=pending)"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p2" target="ds_bookings"/>

    <!-- P2 → P3 -->
    <mxCell id="f9" value="Checkout details"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p2" target="p3"/>

    <!-- P3 ↔ Payment Gateway -->
    <mxCell id="f10" value="Payment request"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p3" target="e_payment"/>
    <mxCell id="f11" value="Payment result"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="e_payment" target="p3"/>

    <!-- P3 → Payments_DB -->
    <mxCell id="f12" value="Store transaction"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p3" target="ds_payments"/>

    <!-- P3 → Bookings_DB -->
    <mxCell id="f13" value="Confirm / Cancel booking"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p3" target="ds_bookings"/>

    <!-- P3 → Seats_DB -->
    <mxCell id="f14" value="Mark seats booked"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p3" target="ds_seats"/>

    <!-- P4 → Bookings_DB -->
    <mxCell id="f15" value="Update booking record"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p4" target="ds_bookings"/>

    <!-- P4 → User -->
    <mxCell id="f16" value="Booking confirmation\nE-ticket"
            style="edgeStyle=orthogonalEdgeStyle;endArrow=block;endFill=1;fontSize=11;"
            edge="1" parent="1" source="p4" target="e_user"/>

    <!-- ===== Legend & Notes ===== -->
    <mxCell id="legend" value="Legend:\nRectangle = External Entity\nEllipse = Process\nDatastore = Data Store\nArrow = Data Flow"
            style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFFFFF;strokeColor=#CCCCCC;fontSize=11;"
            vertex="1" parent="1">
      <mxGeometry x="1080" y="1100" width="360" height="80" as="geometry"/>
    </mxCell>

    <mxCell id="note" value="Notes:\n- Seats held 5 min during payment.\n- Booking saved only if payment succeeds."
            style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF8E1;strokeColor=#E6C86F;fontSize=11;"
            vertex="1" parent="1">
      <mxGeometry x="80" y="1100" width="420" height="80" as="geometry"/>
    </mxCell>

  </root>
</mxGraphModel>
